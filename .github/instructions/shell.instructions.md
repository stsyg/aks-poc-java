---
applyTo: "**/*.sh"
---

# Shell Script Instructions

## Bash Conventions
- Start every script with `#!/usr/bin/env bash` and `set -euo pipefail`.
- Source `.env` at the top: `source "$(dirname "$0")/../.env"`.
- Use `echo` statements to show progress (prefix with `>>>` for visibility).
- Quote all variables: `"$VAR"` not `$VAR`.
- Use `[[ ]]` for conditionals, not `[ ]`.

## Error Handling
- The `set -e` flag ensures the script exits on any command failure.
- Use `|| { echo "ERROR: ..."; exit 1; }` for critical commands that need custom error messages.
- Validate required environment variables at the top of each script.

## Azure CLI
- Use `--output none` for commands where output is not needed (cleaner logs).
- Use `--output tsv` when capturing a single value into a variable.
- Use `--query` with JMESPath for extracting specific fields.
- Always include `--tags environment=Lab designation=Poc provisioner=Manual` when creating resources.

## Kubernetes
- Use `kubectl wait --for=condition=ready pod -l app=<name> --timeout=300s` between dependent deployments.
- Use `kubectl apply -f` for idempotent deployments.
- Use `envsubst` to substitute `$ACR_NAME` in manifests before applying.

## Environment Variables
- Static config (subscription, location, VNet) comes from `.env.example` â†’ `.env`.
- Dynamic names (with random suffix) are generated by `deploy-infra.sh` and appended to `.env`.
- All scripts source `.env` to get both static and dynamic values.
